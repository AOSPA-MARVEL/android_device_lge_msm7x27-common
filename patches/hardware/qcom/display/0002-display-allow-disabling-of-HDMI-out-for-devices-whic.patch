From 7001595092e6fee28d627599a1a0093bcb857c5d Mon Sep 17 00:00:00 2001
From: Pavel Kirpichyov <pavel.kirpichyov@gmail.com>
Date: Sat, 1 Dec 2012 16:03:30 -0700
Subject: [PATCH] display: allow disabling of HDMI out for devices which
 don't support it

Change-Id: I23f07735b529f80d09663c35e79c6d810b837a16
---
 common.mk                   |    4 ++++
 libhwcomposer/hwc.cpp       |    2 ++
 libhwcomposer/hwc_utils.cpp |    2 ++
 3 files changed, 8 insertions(+)

diff --git a/common.mk b/common.mk
index 4e4f99e..66f9a60 100644
--- a/common.mk
+++ b/common.mk
@@ -34,6 +34,10 @@ ifeq ($(TARGET_USES_ION), true)
     common_flags += -DUSE_ION
 endif
 
+ifeq ($(BOARD_HAS_NO_HDMI),true)
+    common_flags += -DNO_HDMI
+endif
+
 common_deps  :=
 kernel_includes :=
 
diff --git a/libhwcomposer/hwc.cpp b/libhwcomposer/hwc.cpp
index 57763c4..c57a1a9 100644
--- a/libhwcomposer/hwc.cpp
+++ b/libhwcomposer/hwc.cpp
@@ -72,7 +72,9 @@ static void hwc_registerProcs(struct hwc_composer_device_1* dev,
 
     // Now that we have the functions needed, kick off
     // the uevent & vsync threads
+#ifdef NO_HDMI
     init_uevent_thread(ctx);
+#endif
 #ifndef NO_HW_VSYNC
     init_vsync_thread(ctx);
 #endif
diff --git a/libhwcomposer/hwc_utils.cpp b/libhwcomposer/hwc_utils.cpp
index 41a9c5a..c9be2b8 100644
--- a/libhwcomposer/hwc_utils.cpp
+++ b/libhwcomposer/hwc_utils.cpp
@@ -59,7 +59,9 @@ void initContext(hwc_context_t *ctx)
     ctx->mMDP.version = qdutils::MDPVersion::getInstance().getMDPVersion();
     ctx->mMDP.hasOverlay = qdutils::MDPVersion::getInstance().hasOverlay();
     ctx->mMDP.panel = qdutils::MDPVersion::getInstance().getPanelType();
+#ifdef NO_HDMI
     ctx->mExtDisplay = new ExternalDisplay(ctx);
+#endif
     MDPComp::init(ctx);
 
     pthread_mutex_init(&(ctx->vstate.lock), NULL);
-- 
1.7.10.4

